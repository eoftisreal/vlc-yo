diff --git a/src/spawn-posix.c b/src/spawn-posix.c
index 8cdd032..0791b8a 100644
--- a/src/spawn-posix.c
+++ b/src/spawn-posix.c
@@ -58,6 +58,8 @@
 #define _GPGRT_NEED_AFLOCAL 1
 #include "gpgrt-int.h"
 
+#ifndef GPGRT_LOCK_NOT_SUPPORTED
+
 /* Definition for the gpgrt_spawn_actions_t.  Note that there is a
  * different one for Windows.  */
 struct gpgrt_spawn_actions {
@@ -1066,3 +1068,5 @@ _gpgrt_process_wait_list (gpgrt_process_t *process_list, int count, int hang)
 
   return ec;
 }
+
+#endif /* !GPGRT_LOCK_NOT_SUPPORTED */
diff --git a/src/spawn-w32.c b/src/spawn-w32.c
index cb15dd0..3a3b648 100644
--- a/src/spawn-w32.c
+++ b/src/spawn-w32.c
@@ -49,6 +49,8 @@
 #define NEED_STRUCT_SPAWN_CB_ARG
 #include "gpgrt-int.h"
 
+#ifndef GPGRT_LOCK_NOT_SUPPORTED
+
 /* Define to 1 do enable debugging.  */
 #define DEBUG_W32_SPAWN 0
 
@@ -1218,3 +1220,5 @@ _gpgrt_process_wait_list (gpgrt_process_t *process_list, int count, int hang)
 
   return ec;
 }
+
+#endif /* !GPGRT_LOCK_NOT_SUPPORTED */
diff --git a/src/visibility.c b/src/visibility.c
index 54c4e2a..4a97b6d 100644
--- a/src/visibility.c
+++ b/src/visibility.c
@@ -1133,6 +1133,7 @@ gpgrt_close_all_fds (int from, int *keep_fds)
 }
 #endif /*0*/
 
+#ifndef GPGRT_LOCK_NOT_SUPPORTED
 gpg_err_code_t
 gpgrt_spawn_actions_new (gpgrt_spawn_actions_t *r_act)
 {
@@ -1257,6 +1258,7 @@ gpgrt_process_release (gpgrt_process_t process)
 {
   _gpgrt_process_release (process);
 }
+#endif GPGRT_LOCK_NOT_SUPPORTED
 
 
 int
