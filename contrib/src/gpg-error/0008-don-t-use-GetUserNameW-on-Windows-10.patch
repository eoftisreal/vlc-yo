diff --git a/src/sysutils.c b/src/sysutils.c
index b6d6a55..2830452 100644
--- a/src/sysutils.c
+++ b/src/sysutils.c
@@ -685,10 +685,11 @@ _gpgrt_getusername (void)
   char *result = NULL;
 
 #ifdef HAVE_W32_SYSTEM
+  char *buf;
+#if _WIN32_WINNT < 0x0A00 // _WIN32_WINNT_WIN10
   wchar_t wtmp[1];
   wchar_t *wbuf;
   DWORD wsize = 1;
-  char *buf;
 
   GetUserNameW (wtmp, &wsize);
   wbuf = _gpgrt_malloc (wsize * sizeof *wbuf);
@@ -705,6 +706,21 @@ _gpgrt_getusername (void)
     }
   buf = _gpgrt_wchar_to_utf8 (wbuf, wsize);
   xfree (wbuf);
+#else
+  buf = _gpgrt_malloc (32767);
+  if (!buf)
+    {
+      _gpgrt_w32_set_errno (-1);
+      return NULL;
+    }
+  DWORD written = GetEnvironmentVariableA("USERNAME", buf, 32767);
+  if (written == 0)
+    {
+      _gpgrt_w32_set_errno (-1);
+      xfree (buf);
+      return NULL;
+    }
+#endif
   return buf;
 
 #else /* !HAVE_W32_SYSTEM */
