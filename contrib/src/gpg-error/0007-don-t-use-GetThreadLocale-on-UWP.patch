diff --git a/src/w32-gettext.c b/src/w32-gettext.c
index bf085cd..3186458 100644
--- a/src/w32-gettext.c
+++ b/src/w32-gettext.c
@@ -648,8 +648,12 @@ my_nl_locale_name (const char *categoryname)
       if (retval != NULL && retval[0] != '\0')
         return retval;
 
+#if !WINAPI_FAMILY_PARTITION (WINAPI_PARTITION_DESKTOP)
+      lcid = LOCALE_CUSTOM_DEFAULT;
+#else
       /* Use native Win32 API locale ID.  */
       lcid = GetThreadLocale ();
+#endif
       /* Strip off the sorting rules, keep only the language part.  */
       langid = LANGIDFROMLCID (lcid);
     }
