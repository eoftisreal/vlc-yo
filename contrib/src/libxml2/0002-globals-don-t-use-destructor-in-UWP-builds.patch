diff --git a/globals.c b/globals.c
index 8306f94e..d2467760 100644
--- a/globals.c
+++ b/globals.c
@@ -80,7 +80,9 @@ static int lineNumbersDefaultValue = 1;
 
 #ifdef HAVE_WIN32_THREADS
   #if defined(LIBXML_STATIC) && !defined(LIBXML_STATIC_FOR_DLL)
+   #if WINAPI_FAMILY_PARTITION(WINAPI_PARTITION_DESKTOP)
     #define USE_WAIT_DTOR
+   #endif
   #else
     #define USE_DLL_MAIN
   #endif
